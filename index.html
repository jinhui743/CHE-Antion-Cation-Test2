<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>学品教育学院 - 化学离子测验</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
    <script>
      MathJax = {
        tex: {
          inlineMath: [['\\(', '\\)']],
          displayMath: [['\\[', '\\]']]
        },
        svg: {
          fontCache: 'global'
        }
      };
    </script>
    <script type="text/javascript" id="MathJax-script" async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
    </script>
  <script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/client": "https://aistudiocdn.com/react-dom@^19.2.0/client",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/"
  }
}
</script>
</head>
  <body>
    <div id="root"></div>
    <script type="module">
import React, { useState, useEffect, useCallback, useRef } from 'react';
import ReactDOM from 'react-dom/client';

// --- Constants ---
// ====================================================================================
// 【重要】请将下面的 `LOGO_BASE64` 变量替换为你的 Base64 编码的 Logo 字符串
// ====================================================================================
const LOGO_BASE64 = "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0id2hpdGUiIHdpZHRoPSI0OHB4IiBoZWlnaHQ9IjQ4cHgiPjxwYXRoIGQ9Ik0wIDBoMjR2MjRIMHoiIGZpbGw9Im5vbmUiLz48cGF0aCBkPSJNMTIgM0w0IDEydi02aDJ2NGw2LTQuNSA2IDQuNXYtNGgydjZMMTIgM3ptLTEgNS41bDYgNC41di04bC02IDMuNXpNNiAycDMuNUw2IDQuN1Yyem05IDBoMy41bC0zLjUgMi41VjJ6TTQgMTJoMi41TDEwIDE3di0zTDQgMTJ6bTE2IDBsLTYgNXYtM2wzLjUgNC41SDE0bC00LTZIMTRsLTMuNS01SDE0bDQgNnoiLz48L3N2Zz4=";

const QUIZ_SUBJECT = "化学离子测验";
const QUIZ_TOPIC = "CHE Antion Cation Test";

const GOOGLE_FORM_URL = "https://docs.google.com/forms/d/e/1FAIpQLSd77AOWGYiC6QWqKQLs1ktDX2Mz2gSs5D7-9AFEKM18QG2dFQ/formResponse";

const ENTRY_IDS = {
  timestamp: "entry.1104502796",
  name: "entry.1734280046",
  branch: "entry.324392523",
  grade: "entry.334192525",
  score: "entry.1197406020",
  percentage: "entry.331240590",
  topic: "entry.1909146688",
  reportLink: "entry.2063783972"
};

const CORRECT_ANSWER_SOUND_B64 = "data:audio/mpeg;base64,YOUR_CORRECT_ANSWER_BASE64_STRING_HERE";
const WRONG_ANSWER_SOUND_B64 = "data:audio/mpeg;base64,YOUR_WRONG_ANSWER_BASE64_STRING_HERE";

const QUIZ_QUESTIONS = [
  {
    "question": "What is the ion for Potassium / Apakah ion untuk Kalium?",
    "options": ["\\(K^{2+}\\)", "\\(K^{-}\\)", "\\(K^{+}\\)", "\\(Ka^{+}\\)"],
    "answer": "\\(K^{+}\\)",
    "explanation": "正确答案是 \\(K^{+}\\)。钾(Potassium)是第一主族的碱金属元素，在化学反应中容易失去一个电子，形成带一个单位正电荷的阳离子。"
  },
  {
    "question": "What is the ion for Sodium / Apakah ion untuk Natrium?",
    "options": ["\\(Na^{2+}\\)", "\\(N^{+}\\)", "\\(Na^{+}\\)", "\\(So^{+}\\)"],
    "answer": "\\(Na^{+}\\)",
    "explanation": "正确答案是 \\(Na^{+}\\)。钠(Sodium)是第一主族的碱金属元素，在化学反应中容易失去一个电子，形成带一个单位正电荷的阳离子。"
  },
  {
    "question": "What is the ion for Lithium / Apakah ion untuk Litium?",
    "options": ["\\(L^{+}\\)", "\\(Li^{-}\\)", "\\(Li^{2+}\\)", "\\(Li^{+}\\)"],
    "answer": "\\(Li^{+}\\)",
    "explanation": "正确答案是 \\(Li^{+}\\)。锂(Lithium)是第一主族的碱金属元素，在化学反应中容易失去一个电子，形成带一个单位正电荷的阳离子。"
  },
  {
    "question": "What is the ion for Hydrogen / Apakah ion untuk Hidrogen?",
    "options": ["\\(H^{2+}\\)", "\\(H_2\\)", "\\(H^{+}\\)", "\\(Hy^{+}\\)"],
    "answer": "\\(H^{+}\\)",
    "explanation": "正确答案是 \\(H^{+}\\)。氢(Hydrogen)原子在失去一个电子后，形成氢离子，即质子。"
  },
  {
    "question": "What is the ion for Silver / Apakah ion untuk Argentum?",
    "options": ["\\(Ar^{+}\\)", "\\(Ag^{2+}\\)", "\\(S^{+}\\)", "\\(Ag^{+}\\)"],
    "answer": "\\(Ag^{+}\\)",
    "explanation": "正确答案是 \\(Ag^{+}\\)。银(Silver)是一种过渡金属，通常形成稳定的+1价阳离子。"
  },
  {
    "question": "What is the ion for Mercury / Apakah ion for Merkuri?",
    "options": ["\\(Me^{+}\\)", "\\(Hg^{+}\\)", "\\(Me^{2+}\\)", "\\(Hg^{2+}\\)"],
    "answer": "\\(Hg^{+}\\)",
    "explanation": "正确答案是 \\(Hg^{+}\\)。汞(Mercury)可以形成+1或+2价离子。\\(Hg^{+}\\)实际上是以二聚体离子 \\(Hg_2^{2+}\\) 的形式存在，但题目中通常简化表示。"
  },
  {
    "question": "What is the ion for Ammonium / Apakah ion untuk Ammonium?",
    "options": ["\\(N_4^{+}\\)", "\\(NH_4^{+}\\)", "\\(Am^{+}\\)", "\\(NH_3^{+}\\)"],
    "answer": "\\(NH_4^{+}\\)",
    "explanation": "正确答案是 \\(NH_4^{+}\\)。铵根离子(Ammonium)是由一个氮原子和四个氢原子形成的复合阳离子。"
  },
  {
    "question": "What is the ion for Calcium / Apakah ion untuk Kalsium?",
    "options": ["\\(Ca^{+}\\)", "\\(C^{2+}\\)", "\\(Ca^{2+}\\)", "\\(Cal^{2+}\\)"],
    "answer": "\\(Ca^{2+}\\)",
    "explanation": "正确答案是 \\(Ca^{2+}\\)。钙(Calcium)是第二主族的碱土金属元素，容易失去两个电子，形成带两个单位正电荷的阳离子。"
  },
  {
    "question": "What is the ion for Magnesium / Apakah ion untuk Magnesium?",
    "options": ["\\(Mg^{+}\\)", "\\(Mg^{3+}\\)", "\\(Ma^{2+}\\)", "\\(Mg^{2+}\\)"],
    "answer": "\\(Mg^{2+}\\)",
    "explanation": "正确答案是 \\(Mg^{2+}\\)。镁(Magnesium)是第二主族的碱土金属元素，容易失去两个电子，形成带两个单位正电荷的阳离子。"
  },
  {
    "question": "What is the ion for Zinc / Apakah ion untuk Zink?",
    "options": ["\\(Z^{+}\\)", "\\(Zi^{2+}\\)", "\\(Zn^{+}\\)", "\\(Zn^{2+}\\)"],
    "answer": "\\(Zn^{2+}\\)",
    "explanation": "正确答案是 \\(Zn^{2+}\\)。锌(Zinc)是一种过渡金属，通常形成稳定的+2价阳离子。"
  },
  {
    "question": "What is the ion for Barium / Apakah ion untuk Barium?",
    "options": ["\\(Ba^{+}\\)", "\\(Bar^{2+}\\)", "\\(Ba^{2+}\\)", "\\(Bi^{2+}\\)"],
    "answer": "\\(Ba^{2+}\\)",
    "explanation": "正确答案是 \\(Ba^{2+}\\)。钡(Barium)是第二主族的碱土金属元素，容易失去两个电子，形成带两个单位正电荷的阳离子。"
  },
  {
    "question": "What is the ion for Iron (II) / Apakah ion untuk Ferum (II)?",
    "options": ["\\(Fe^{3+}\\)", "\\(F^{2+}\\)", "\\(Ir^{2+}\\)", "\\(Fe^{2+}\\)"],
    "answer": "\\(Fe^{2+}\\)",
    "explanation": "正确答案是 \\(Fe^{2+}\\)。亚铁离子(Iron II)指的是铁失去两个电子后形成的离子，带两个单位正电荷。"
  },
  {
    "question": "What is the ion for Tin (II) / Apakah ion for Stanum (II)?",
    "options": ["\\(S^{2+}\\)", "\\(Sn^{4+}\\)", "\\(Ti^{2+}\\)", "\\(Sn^{2+}\\)"],
    "answer": "\\(Sn^{2+}\\)",
    "explanation": "正确答案是 \\(Sn^{2+}\\)。亚锡离子(Tin II)指的是锡失去两个电子后形成的离子，带两个单位正电荷。"
  },
  {
    "question": "What is the ion for Lead (II) / Apakah ion for Plumbum (II)?",
    "options": ["\\(P^{2+}\\)", "\\(Pb^{4+}\\)", "\\(Lb^{2+}\\)", "\\(Pb^{2+}\\)"],
    "answer": "\\(Pb^{2+}\\)",
    "explanation": "正确答案是 \\(Pb^{2+}\\)。亚铅离子(Lead II)指的是铅失去两个电子后形成的离子，带两个单位正电荷。"
  },
  {
    "question": "What is the ion for Copper (II) / Apakah ion untuk Kuprum (II)?",
    "options": ["\\(Co^{2+}\\)", "\\(Cu^{+}\\)", "\\(Cp^{2+}\\)", "\\(Cu^{2+}\\)"],
    "answer": "\\(Cu^{2+}\\)",
    "explanation": "正确答案是 \\(Cu^{2+}\\)。铜离子(Copper II)指的是铜失去两个电子后形成的离子，带两个单位正电荷，通常呈蓝色。"
  },
  {
    "question": "What is the ion for Manganese (II) / Apakah ion untuk Mangan (II)?",
    "options": ["\\(Mg^{2+}\\)", "\\(Mn^{+}\\)", "\\(Ma^{2+}\\)", "\\(Mn^{2+}\\)"],
    "answer": "\\(Mn^{2+}\\)",
    "explanation": "正确答案是 \\(Mn^{2+}\\)。亚锰离子(Manganese II)指的是锰失去两个电子后形成的离子，带两个单位正电荷。"
  },
  {
    "question": "What is the ion for Aluminium / Apakah ion untuk Aluminium?",
    "options": ["\\(Al^{2+}\\)", "\\(Am^{3+}\\)", "\\(A^{3+}\\)", "\\(Al^{3+}\\)"],
    "answer": "\\(Al^{3+}\\)",
    "explanation": "正确答案是 \\(Al^{3+}\\)。铝(Aluminium)是第十三主族的金属元素，容易失去三个电子，形成带三个单位正电荷的阳离子。"
  },
  {
    "question": "What is the ion for Iron (III) / Apakah ion untuk Ferum (III)?",
    "options": ["\\(F^{3+}\\)", "\\(Ir^{3+}\\)", "\\(Fe^{2+}\\)", "\\(Fe^{3+}\\)"],
    "answer": "\\(Fe^{3+}\\)",
    "explanation": "正确答案是 \\(Fe^{3+}\\)。铁离子(Iron III)指的是铁失去三个电子后形成的离子，带三个单位正电荷。"
  },
  {
    "question": "What is the ion for Chromium (III) / Apakah ion untuk Kromium (III)?",
    "options": ["\\(C^{3+}\\)", "\\(Ch^{3+}\\)", "\\(Cr^{2+}\\)", "\\(Cr^{3+}\\)"],
    "answer": "\\(Cr^{3+}\\)",
    "explanation": "正确答案是 \\(Cr^{3+}\\)。铬离子(Chromium III)指的是铬失去三个电子后形成的离子，带三个单位正电荷。"
  },
  {
    "question": "What is the ion for Oxide / Apakah ion untuk Oksida?",
    "options": ["\\(O^{-}\\)", "\\(Ox^{2-}\\)", "\\(O_3^{2-}\\)", "\\(O^{2-}\\)"],
    "answer": "\\(O^{2-}\\)",
    "explanation": "正确答案是 \\(O^{2-}\\)。氧(Oxygen)是第十六主族的非金属元素，容易得到两个电子，形成带两个单位负电荷的氧离子。"
  },
  {
    "question": "What is the ion for Fluoride / Apakah ion untuk Florida?",
    "options": ["\\(Fl^{-}\\)", "\\(F^{2-}\\)", "\\(Fo^{-}\\)", "\\(F^{-}\\)"],
    "answer": "\\(F^{-}\\)",
    "explanation": "正确答案是 \\(F^{-}\\)。氟(Fluorine)是第十七主族的卤素元素，容易得到一个电子，形成带一个单位负电荷的氟离子。"
  },
  {
    "question": "What is the ion for Chloride / Apakah ion untuk Klorida?",
    "options": ["\\(Ch^{-}\\)", "\\(Cl^{2-}\\)", "\\(C^{-}\\)", "\\(Cl^{-}\\)"],
    "answer": "\\(Cl^{-}\\)",
    "explanation": "正确答案是 \\(Cl^{-}\\)。氯(Chlorine)是第十七主族的卤素元素，容易得到一个电子，形成带一个单位负电荷的氯离子。"
  },
  {
    "question": "What is the ion for Bromide / Apakah ion untuk Bromida?",
    "options": ["\\(Bo^{-}\\)", "\\(B^{-}\\)", "\\(Br^{2-}\\)", "\\(Br^{-}\\)"],
    "answer": "\\(Br^{-}\\)",
    "explanation": "正确答案是 \\(Br^{-}\\)。溴(Bromine)是第十七主族的卤素元素，容易得到一个电子，形成带一个单位负电荷的溴离子。"
  },
  {
    "question": "What is the ion for Iodide / Apakah ion untuk Iodida?",
    "options": ["\\(Io^{-}\\)", "\\(I^{2-}\\)", "\\(Id^{-}\\)", "\\(I^{-}\\)"],
    "answer": "\\(I^{-}\\)",
    "explanation": "正确答案是 \\(I^{-}\\)。碘(Iodine)是第十七主族的卤素元素，容易得到一个电子，形成带一个单位负电荷的碘离子。"
  },
  {
    "question": "What is the ion for Hydroxide / Apakah ion untuk Hidroksida?",
    "options": ["\\(H^{-}\\)", "\\(OH^{-}\\)", "\\(O^{-}\\)", "\\(Ho^{-}\\)"],
    "answer": "\\(OH^{-}\\)",
    "explanation": "正确答案是 \\(OH^{-}\\)。氢氧根离子(Hydroxide)是由一个氧原子和一个氢原子形成的复合阴离子，带一个单位负电荷。"
  },
  {
    "question": "What is the ion for Sulphate / Apakah ion untuk Sulfat?",
    "options": ["\\(S^{2-}\\)", "\\(Sul^{2-}\\)", "\\(SO_4^{2-}\\)", "\\(SO_3^{2-}\\)"],
    "answer": "\\(SO_4^{2-}\\)",
    "explanation": "正确答案是 \\(SO_4^{2-}\\)。硫酸根离子(Sulphate)是由一个硫原子和四个氧原子形成的复合阴离子，带两个单位负电荷。"
  },
  {
    "question": "What is the ion for Nitrate / Apakah ion for Nitrat?",
    "options": ["\\(N^{-}\\)", "\\(Ni^{-}\\)", "\\(NO_2^{-}\\)", "\\(NO_3^{-}\\)"],
    "answer": "\\(NO_3^{-}\\)",
    "explanation": "正确答案是 \\(NO_3^{-}\\)。硝酸根离子(Nitrate)是由一个氮原子和三个氧原子形成的复合阴离子，带一个单位负电荷。"
  },
  {
    "question": "What is the ion for Carbonate / Apakah ion untuk Karbonat?",
    "options": ["\\(C^{2-}\\)", "\\(Ca^{2-}\\)", "\\(CO_2^{2-}\\)", "\\(CO_3^{2-}\\)"],
    "answer": "\\(CO_3^{2-}\\)",
    "explanation": "正确答案是 \\(CO_3^{2-}\\)。碳酸根离子(Carbonate)是由一个碳原子和三个氧原子形成的复合阴离子，带两个单位负电荷。"
  },
  {
    "question": "What is the ion for Ethanoate / Apakah ion untuk Etanoat?",
    "options": ["\\(Et^{-}\\)", "\\(CH_2COO^{-}\\)", "\\(CH_3COO^{-}\\)", "\\(COOH^{-}\\)"],
    "answer": "\\(CH_3COO^{-}\\)",
    "explanation": "正确答案是 \\(CH_3COO^{-}\\)。乙酸根离子(Ethanoate)也叫醋酸根离子，是乙酸失去一个质子后形成的阴离子。"
  },
  {
    "question": "What is the ion for Manganate(VII) / Apakah ion untuk Manganat (VII)?",
    "options": ["\\(MnO_3^{-}\\)", "\\(Mn^{7-}\\)", "\\(MaO_4^{-}\\)", "\\(MnO_4^{-}\\)"],
    "answer": "\\(MnO_4^{-}\\)",
    "explanation": "正确答案是 \\(MnO_4^{-}\\)。高锰酸根离子(Manganate(VII))中锰的氧化态为+7，整个离子带一个单位负电荷。"
  },
  {
    "question": "What is the ion for Dichromate(VI) / Apakah ion untuk Dikromat (VI)?",
    "options": ["\\(CrO_4^{2-}\\)", "\\(DiCrO_7^{2-}\\)", "\\(Cr_2O_6^{2-}\\)", "\\(Cr_2O_7^{2-}\\)"],
    "answer": "\\(Cr_2O_7^{2-}\\)",
    "explanation": "正确答案是 \\(Cr_2O_7^{2-}\\)。重铬酸根离子(Dichromate(VI))中铬的氧化态为+6，整个离子带两个单位负电荷。"
  },
  {
    "question": "What is the ion for Phosphate / Apakah ion untuk Fosfat?",
    "options": ["\\(P^{3-}\\)", "\\(PhO_4^{3-}\\)", "\\(PO_3^{3-}\\)", "\\(PO_4^{3-}\\)"],
    "answer": "\\(PO_4^{3-}\\)",
    "explanation": "正确答案是 \\(PO_4^{3-}\\)。磷酸根离子(Phosphate)是由一个磷原子和四个氧原子形成的复合阴离子，带三个单位负电荷。"
  },
  {
    "question": "What is the ion for Thiosulphate / Apakah ion for Tiosulfat?",
    "options": ["\\(S O_3^{2-}\\)", "\\(ThO_3^{2-}\\)", "\\(S_2O_4^{2-}\\)", "\\(S_2O_3^{2-}\\)"],
    "answer": "\\(S_2O_3^{2-}\\)",
    "explanation": "正确答案是 \\(S_2O_3^{2-}\\)。硫代硫酸根离子(Thiosulphate)结构上可以看作是硫酸根离子中的一个氧原子被硫原子取代，整个离子带两个单位负电荷。"
  }
];

const getFeedbackMessage = (percentage) => {
  if (percentage >= 90) {
    return "太棒了！你对离子式的掌握非常扎实，继续保持！";
  } else if (percentage >= 70) {
    return "很不错！大部分都答对了，再巩固一下就更完美了！";
  } else if (percentage >= 50) {
    return "继续加油！这次测试是一个很好的学习机会，弄懂错题你就会进步很大！"
  } else {
    return "别灰心，化学学习需要耐心和重复。从错误中学习，下次一定会更好！";
  }
};

const playAudio = (base64Audio) => {
  try {
    const audio = new Audio(base64Audio);
    audio.play().catch(e => console.error("Audio play failed", e));
  } catch (error) {
    console.error("Failed to play audio:", error);
  }
};


// --- App Components ---

const compressData = (data) => {
  try {
    const jsonString = JSON.stringify(data);
    const compressed = pako.deflate(jsonString, { to: 'string' });
    return btoa(compressed);
  } catch (error) {
    console.error("Compression failed:", error);
    return "";
  }
};

const decompressData = (base64String) => {
  try {
    const binaryString = atob(base64String);
    const jsonString = pako.inflate(binaryString, { to: 'string' });
    return JSON.parse(jsonString);
  } catch (error) {
    console.error("Decompression failed:", error);
    return null;
  }
};

const StudentInfoPage = ({ onStartQuiz }) => {
  const [name, setName] = useState('');
  const [branch, setBranch] = useState('Permas分院');
  const [grade, setGrade] = useState('');
  const [error, setError] = useState('');

  const handleSubmit = (e) => {
    e.preventDefault();
    if (!name.trim() || !branch || !grade.trim()) {
      setError('请填写所有信息。');
      return;
    }
    setError('');
    onStartQuiz({ name, branch, grade });
  };

  return React.createElement('form', { onSubmit: handleSubmit, className: "space-y-6" },
    React.createElement('h2', { className: "text-2xl font-bold text-center text-gray-800" }, "学生信息"),
    error && React.createElement('p', { className: "text-red-500 text-center" }, error),
    React.createElement('div', null,
      React.createElement('label', { htmlFor: "name", className: "block text-sm font-medium text-gray-700" }, "姓名 (Name)"),
      React.createElement('input', {
        type: "text",
        id: "name",
        value: name,
        onChange: (e) => setName(e.target.value),
        className: "mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm text-gray-900",
        placeholder: "请输入你的名字"
      })
    ),
    React.createElement('div', null,
      React.createElement('label', { htmlFor: "branch", className: "block text-sm font-medium text-gray-700" }, "分院 (Cawangan)"),
      React.createElement('select', {
        id: "branch",
        value: branch,
        onChange: (e) => setBranch(e.target.value),
        className: "mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm text-gray-900"
      },
        React.createElement('option', null, "Permas分院"),
        React.createElement('option', null, "Masai分院")
      )
    ),
    React.createElement('div', null,
      React.createElement('label', { htmlFor: "grade", className: "block text-sm font-medium text-gray-700" }, "年级 (Grade)"),
      React.createElement('input', {
        type: "text",
        id: "grade",
        value: grade,
        onChange: (e) => setGrade(e.target.value),
        className: "mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm text-gray-900",
        placeholder: "例如: Form 4"
      })
    ),
    React.createElement('button', {
      type: "submit",
      className: "w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all duration-200 transform hover:scale-105"
    }, "开始测验")
  );
};

const ProgressBar = ({ current, total }) => {
    const percentage = total > 0 ? (current / total) * 100 : 0;
    return (
        React.createElement('div', { className: "w-full bg-slate-200 rounded-full h-4 relative grid place-items-center" },
            React.createElement('span', { className: "text-xs font-bold text-slate-700 z-10" }, `${current} / ${total}`),
            React.createElement('div', {
                className: "absolute top-0 left-0 h-full w-full bg-slate-700 rounded-full grid place-items-center overflow-hidden",
                style: {
                    clipPath: `polygon(0 0, ${percentage}% 0, ${percentage}% 100%, 0 100%)`,
                    transition: 'clip-path 500ms ease-in-out',
                }
            },
            React.createElement('span', { className: "text-xs font-bold text-white" }, `${current} / ${total}`)
            )
        )
    );
};


const CheckIcon = () => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", className: "h-6 w-6", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor" },
    React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M5 13l4 4L19 7" })
);

const XIcon = () => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", className: "h-6 w-6", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor" },
    React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M6 18L18 6M6 6l12 12" })
);

const ClockIcon = () => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", className:"h-8 w-8 text-slate-500", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor" },
    React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" })
);

const CheckCircleIcon = () => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", className:"h-8 w-8 text-slate-500", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor" },
    React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" })
);


const QuizPage = ({ questions, onQuizComplete }) => {
    const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
    const [selectedAnswer, setSelectedAnswer] = useState(null);
    const [isCorrect, setIsCorrect] = useState(null);
    const [showExplanation, setShowExplanation] = useState(false);
    const [userAnswers, setUserAnswers] = useState([]);
    const [time, setTime] = useState(0);
    const questionContainerRef = useRef(null);
    const currentQuestion = questions[currentQuestionIndex];

    useEffect(() => {
        const timer = setInterval(() => {
            setTime(prevTime => prevTime + 1);
        }, 1000);
        return () => clearInterval(timer);
    }, []);

    useEffect(() => {
        if (window.MathJax && questionContainerRef.current) {
            window.MathJax.typesetPromise([questionContainerRef.current])
              .catch((err) => console.error('MathJax typesetting failed:', err));
        }
    }, [currentQuestion, selectedAnswer]);

    const handleAnswerSelect = (option) => {
        if (selectedAnswer !== null) return;
        const correct = option === currentQuestion.answer;
        if (correct) playAudio(CORRECT_ANSWER_SOUND_B64); else playAudio(WRONG_ANSWER_SOUND_B64);
        setSelectedAnswer(option);
        setIsCorrect(correct);
        if (!correct) setShowExplanation(true);
        setUserAnswers([...userAnswers, { question: currentQuestion.question, selected: option, correct: currentQuestion.answer, isCorrect: correct }]);
    };

    const handleNextQuestion = () => {
        if (currentQuestionIndex < questions.length - 1) {
            setCurrentQuestionIndex(prevIndex => prevIndex + 1);
            setSelectedAnswer(null);
            setIsCorrect(null);
            setShowExplanation(false);
        } else {
            const correctCount = userAnswers.filter(a => a.isCorrect).length;
            const totalQuestions = questions.length;
            const score = Math.round((correctCount / totalQuestions) * 100);
            const minutes = Math.floor(time / 60);
            const seconds = time % 60;
            const timeTaken = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            onQuizComplete({ score, correctCount, totalQuestions, timeTaken, answers: userAnswers });
        }
    };

    return React.createElement('div', { ref: questionContainerRef, className: "space-y-6" },
        React.createElement('div', { className: "flex justify-between items-center text-slate-600 space-x-4" },
            React.createElement(ProgressBar, { current: currentQuestionIndex + 1, total: questions.length }),
            React.createElement('p', { className: "font-medium whitespace-nowrap text-sm" }, `用时: ${Math.floor(time / 60).toString().padStart(2, '0')}:${(time % 60).toString().padStart(2, '0')}`)
        ),
        React.createElement('div', { className: "text-xl font-semibold text-slate-800 text-center py-4" }, currentQuestion.question),
        React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-4" },
            currentQuestion.options.map((option, index) => {
                let buttonClass = "w-full text-left p-4 rounded-lg border transition-all duration-300 transform flex justify-between items-center text-slate-800";
                if (selectedAnswer !== null) {
                    const isSelected = option === selectedAnswer;
                    const isAnswer = option === currentQuestion.answer;
                    if (isAnswer) {
                        buttonClass += " bg-emerald-500 border-emerald-600 text-white font-bold shadow-lg";
                    } else if (isSelected && !isCorrect) {
                        buttonClass += " bg-red-500 border-red-600 text-white font-bold shadow-lg";
                    } else {
                        buttonClass += " border-slate-300 bg-slate-50 opacity-50 cursor-not-allowed";
                    }
                } else {
                    buttonClass += " bg-white border-slate-300 cursor-pointer hover:border-indigo-500 hover:shadow-md hover:-translate-y-1";
                }

                return React.createElement('button', {
                    key: index,
                    onClick: () => handleAnswerSelect(option),
                    disabled: selectedAnswer !== null,
                    className: buttonClass
                }, 
                  React.createElement('span', null, option),
                  selectedAnswer !== null && option === currentQuestion.answer && React.createElement(CheckIcon),
                  selectedAnswer !== null && option === selectedAnswer && !isCorrect && React.createElement(XIcon)
                );
            })
        ),
        showExplanation && React.createElement('div', { className: "p-4 bg-indigo-50 border-l-4 border-indigo-400 rounded-r-lg mt-4" },
            React.createElement('h3', { className: "font-bold text-indigo-800" }, "解题思路"),
            React.createElement('p', { className: "text-indigo-700 mt-2" }, currentQuestion.explanation)
        ),
        selectedAnswer !== null && React.createElement('button', {
            onClick: handleNextQuestion,
            className: "w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all duration-200 transform hover:scale-105"
        }, currentQuestionIndex < questions.length - 1 ? '下一题' : '完成测验')
    );
};

const CircularProgress = ({ percentage }) => {
    const radius = 60;
    const stroke = 10;
    const normalizedRadius = radius - stroke * 2;
    const circumference = normalizedRadius * 2 * Math.PI;
    const strokeDashoffset = circumference - (percentage / 100) * circumference;
    const color = percentage >= 50 ? 'stroke-emerald-500' : 'stroke-red-500';

    return React.createElement('div', { className: "relative inline-block" },
        React.createElement('svg', { height: radius * 2, width: radius * 2, className: "-rotate-90" },
            React.createElement('circle', {
                className: "text-slate-200",
                strokeWidth: stroke,
                stroke: "currentColor",
                fill: "transparent",
                r: normalizedRadius,
                cx: radius,
                cy: radius
            }),
            React.createElement('circle', {
                className: `${color} transition-all duration-1000 ease-out`,
                strokeWidth: stroke,
                strokeDasharray: `${circumference} ${circumference}`,
                style: { strokeDashoffset },
                stroke: "currentColor",
                fill: "transparent",
                r: normalizedRadius,
                cx: radius,
                cy: radius,
                strokeLinecap: "round"
            })
        ),
        React.createElement('div', { className: "absolute inset-0 flex items-center justify-center" },
            React.createElement('span', { className: `text-4xl font-bold ${percentage >= 50 ? 'text-emerald-600' : 'text-red-600'}` },
                `${percentage}`,
                React.createElement('span', { className: "text-2xl" }, "%")
            )
        )
    );
};


const ReportPage = ({ result, studentData, onRetry }) => {
    const [shareableLink, setShareableLink] = useState('');

    useEffect(() => {
        const dataToShare = { result, studentData };
        const compressed = compressData(dataToShare);
        const link = `${window.location.origin}${window.location.pathname}?data=${compressed}`;
        setShareableLink(link);
    }, [result, studentData]);

    const handleCopyToClipboard = () => {
        navigator.clipboard.writeText(shareableLink).then(() => {
            alert('报告链接已复制到剪贴板！');
        }, () => {
            alert('复制失败，请手动复制。');
        });
    };
    
    useEffect(() => {
        if (window.MathJax) {
            window.MathJax.typesetPromise();
        }
    }, []);

    const percentage = result.score;

    return React.createElement('div', { className: "text-center space-y-6" },
        React.createElement('h2', { className: "text-3xl font-bold text-slate-800" }, "成绩报告单"),
        React.createElement('div', { className: "p-4 bg-slate-50 rounded-lg" },
            React.createElement('div', { className: "grid grid-cols-2 gap-x-4 gap-y-2 text-left text-sm text-slate-600" },
                React.createElement('p', null, React.createElement('strong', {className: "text-slate-800"}, "姓名:"), ` ${studentData.name}`),
                React.createElement('p', null, React.createElement('strong', {className: "text-slate-800"}, "分院:"), ` ${studentData.branch}`),
                React.createElement('p', null, React.createElement('strong', {className: "text-slate-800"}, "年级:"), ` ${studentData.grade}`),
                React.createElement('p', null, React.createElement('strong', {className: "text-slate-800"}, "科目:"), ` ${QUIZ_SUBJECT}`)
            )
        ),
        React.createElement('div', { className: "flex justify-center items-center py-4" },
            React.createElement(CircularProgress, { percentage: percentage })
        ),
        React.createElement('div', { className: "grid grid-cols-2 gap-4" },
            React.createElement('div', {className: "bg-slate-50 p-4 rounded-lg flex flex-col items-center justify-center space-y-2"},
                React.createElement(CheckCircleIcon),
                React.createElement('p', { className: "text-sm text-slate-600" }, "正确率"),
                React.createElement('p', { className: "text-2xl font-semibold text-slate-800" }, `${result.correctCount} / ${result.totalQuestions}`)
            ),
             React.createElement('div', {className: "bg-slate-50 p-4 rounded-lg flex flex-col items-center justify-center space-y-2"},
                React.createElement(ClockIcon),
                React.createElement('p', { className: "text-sm text-slate-600" }, "用时"),
                React.createElement('p', { className: "text-2xl font-semibold text-slate-800" }, result.timeTaken)
            )
        ),
        React.createElement('div', { className: "p-4 bg-indigo-50 border border-indigo-200 rounded-lg text-indigo-800" },
            React.createElement('p', { className: "font-semibold" }, getFeedbackMessage(percentage))
        ),
        React.createElement('div', { className: "space-y-4" },
            React.createElement('div', { className: "relative" },
                React.createElement('input', {
                    type: "text",
                    readOnly: true,
                    value: shareableLink,
                    className: "w-full p-2 pr-14 border border-slate-300 rounded-md bg-slate-100 text-xs text-slate-600"
                }),
                React.createElement('button', { onClick: handleCopyToClipboard, className: "absolute right-1 top-1/2 -translate-y-1/2 px-2 py-1 text-xs bg-indigo-500 text-white rounded hover:bg-indigo-600" }, "复制")
            ),
            React.createElement('button', {
                onClick: onRetry,
                className: "w-full flex justify-center py-3 px-4 border border-slate-300 rounded-lg shadow-sm text-sm font-medium text-slate-700 bg-white hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all duration-200"
            }, "再试一次")
        )
    );
};

const App = () => {
    const [currentPage, setCurrentPage] = useState('info');
    const [studentData, setStudentData] = useState(null);
    const [quizResult, setQuizResult] = useState(null);
    const [isLoading, setIsLoading] = useState(true);
    const [shuffledQuestions, setShuffledQuestions] = useState([]);

    useEffect(() => {
        const urlParams = new URLSearchParams(window.location.search);
        const data = urlParams.get('data');
        if (data) {
            const decompressedData = decompressData(data);
            if (decompressedData) {
                setQuizResult(decompressedData.result);
                setStudentData(decompressedData.studentData);
                setCurrentPage('report');
            }
        }
        setIsLoading(false);
    }, []);

    const handleStartQuiz = (data) => {
        const shuffled = [...QUIZ_QUESTIONS]
            .sort(() => Math.random() - 0.5) // Shuffle questions
            .map(question => ({ // For each question...
                ...question, // copy the question properties
                options: [...question.options].sort(() => Math.random() - 0.5) // ...and shuffle its options
            }));
        setShuffledQuestions(shuffled);
        setStudentData(data);
        setCurrentPage('quiz');
    };

    const submitToGoogleForm = useCallback(async (result, data, link) => {
        const formData = new FormData();
        const now = new Date();
        formData.append(ENTRY_IDS.timestamp, now.toLocaleString('en-CA'));
        formData.append(ENTRY_IDS.name, data.name);
        formData.append(ENTRY_IDS.branch, data.branch);
        formData.append(ENTRY_IDS.grade, data.grade);
        formData.append(ENTRY_IDS.score, `${result.score}%`);
        formData.append(ENTRY_IDS.percentage, `${result.correctCount}/${result.totalQuestions}`);
        formData.append(ENTRY_IDS.topic, QUIZ_TOPIC);
        formData.append(ENTRY_IDS.reportLink, link);
        
        try {
            await fetch(GOOGLE_FORM_URL, {
                method: 'POST',
                body: formData,
                mode: 'no-cors',
            });
        } catch (error) {
            console.error('Error submitting to Google Form:', error);
        }
    }, []);

    const handleQuizComplete = useCallback((result) => {
        setQuizResult(result);
        setCurrentPage('report');
        if (studentData) {
            const dataToShare = { result, studentData };
            const compressed = compressData(dataToShare);
            const link = `${window.location.origin}${window.location.pathname}?data=${compressed}`;
            submitToGoogleForm(result, studentData, link);
        }
    }, [studentData, submitToGoogleForm]);

    const handleRetry = () => {
        setQuizResult(null);
        setStudentData(null);
        setCurrentPage('info');
        window.history.pushState({}, '', window.location.pathname);
    };

    const renderPage = () => {
        if (isLoading) {
            return React.createElement('div', { className: "text-center p-10" }, "加载中...");
        }
        switch (currentPage) {
            case 'info':
                return React.createElement(StudentInfoPage, { onStartQuiz: handleStartQuiz });
            case 'quiz':
                return React.createElement(QuizPage, { questions: shuffledQuestions, onQuizComplete: handleQuizComplete });
            case 'report':
                if (quizResult && studentData) {
                    return React.createElement(ReportPage, { result: quizResult, studentData: studentData, onRetry: handleRetry });
                }
                return React.createElement(StudentInfoPage, { onStartQuiz: handleStartQuiz });
            default:
                return React.createElement(StudentInfoPage, { onStartQuiz: handleStartQuiz });
        }
    };

    return React.createElement('div', { className: "bg-slate-100 min-h-screen flex items-center justify-center p-4 font-sans" },
        React.createElement('main', { className: "w-full max-w-2xl bg-white rounded-2xl shadow-lg overflow-hidden my-8" },
            React.createElement('header', { className: "p-6 bg-gradient-to-r from-blue-600 to-indigo-700 text-white" },
                React.createElement('div', { className: "flex items-center space-x-4" },
                    React.createElement('img', { 
                      src: LOGO_BASE64, 
                      alt: "Logo", 
                      className: "h-12 w-12" 
                    }),
                    React.createElement('div', null,
                        React.createElement('h1', { className: "text-2xl font-bold" }, "学品教育学院"),
                        React.createElement('p', { className: "text-sm opacity-90" }, QUIZ_TOPIC)
                    )
                )
            ),
            React.createElement('div', { className: "p-6 md:p-8" },
                renderPage()
            )
        )
    );
};


const rootElement = document.getElementById('root');
if (!rootElement) {
  throw new Error("Could not find root element to mount to");
}

const root = ReactDOM.createRoot(rootElement);
root.render(
  React.createElement(React.StrictMode, null, React.createElement(App))
);

    </script>
  </body>
</html>